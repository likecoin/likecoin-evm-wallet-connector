import * as React from "react";
import { Description, DialogTitle, Field, Input } from "@headlessui/react";
import { clsx } from "clsx/lite";

import { PlainDialog } from "./PlainDialog";
import { CosmostationIcon } from "./CosmostationIcon";
import { KeplrIcon } from "./KeplrIcon";
import { MetamaskIcon } from "./MetamaskIcon";
import { RabbyIcon } from "./RabbyIcon";

export interface ConnectPortalDialogProps {
  providers?: { id: string; name: string }[];
  isOpen?: boolean;
  onConnect?: (id: string, payload?: { email: string }) => void;
  onClose?: () => void;
}

export const ConnectPortalDialog: React.FC<ConnectPortalDialogProps> = (
  props
) => {
  const [email, setEmail] = React.useState("");

  function handleClose() {
    props.onClose?.();
    setEmail("");
  }

  function connectWith(id: string) {
    if (id === "email" && !email) {
      return;
    }
    props.onConnect?.(id, { email });
  }

  return (
    <PlainDialog isOpen={props.isOpen} onClose={handleClose}>
      <svg
        className="lk-mb-[52px] lk-text-likecoin-500"
        xmlns="http://www.w3.org/2000/svg"
        width="98"
        height="20"
        fill="none"
      >
        <path
          fill="currentColor"
          d="M8.172 17.013H3.204a.263.263 0 0 1-.22-.082.283.283 0 0 1-.077-.228V5.87a.582.582 0 0 0-.157-.458.54.54 0 0 0-.441-.16H.599a.523.523 0 0 0-.44.16.564.564 0 0 0-.156.458v12.707c0 .787.424 1.238 1.194 1.238h6.975a.522.522 0 0 0 .44-.161.564.564 0 0 0 .156-.457V17.63a.58.58 0 0 0-.155-.457.54.54 0 0 0-.441-.161ZM81.27 10.892h-1.908a.517.517 0 0 0-.432.165.557.557 0 0 0-.147.453v7.687a.573.573 0 0 0 .147.453.533.533 0 0 0 .432.165h1.909a.52.52 0 0 0 .432-.165.56.56 0 0 0 .149-.453V11.51a.577.577 0 0 0-.149-.453.535.535 0 0 0-.432-.165ZM79.42 8.888c.162-.102.137-.278.12-.416-.085-.684-.734-3.605-.933-4.204a.423.423 0 0 0-.176-.278.39.39 0 0 0-.316-.054c-.283.057-.65.247-1.227.607-.577.361-.912.61-1.09.843a.42.42 0 0 0-.101.315.428.428 0 0 0 .154.292c.424.462 2.61 2.42 3.154 2.813.11.08.249.187.41.084l.004-.002ZM81.116 5.027c.168.093.3-.022.405-.108a34.637 34.637 0 0 0 3.006-2.98.413.413 0 0 0 .14-.3.43.43 0 0 0-.117-.31c-.19-.22-.536-.452-1.13-.78-.594-.328-.972-.5-1.256-.541a.39.39 0 0 0-.314.071.415.415 0 0 0-.163.287c-.168.61-.666 3.561-.715 4.25-.01.139-.028.314.14.41l.004.001ZM16.362 10.892h-1.91a.519.519 0 0 0-.431.165.56.56 0 0 0-.15.453v7.687a.575.575 0 0 0 .15.453.535.535 0 0 0 .432.165h1.909a.518.518 0 0 0 .432-.165.559.559 0 0 0 .147-.453V11.51a.573.573 0 0 0-.147-.453.533.533 0 0 0-.432-.165ZM14.51 8.888c.164-.102.136-.277.119-.416-.083-.684-.732-3.605-.931-4.204a.423.423 0 0 0-.177-.277.392.392 0 0 0-.315-.055c-.282.058-.652.247-1.226.607-.575.361-.913.61-1.09.843a.42.42 0 0 0-.102.315.428.428 0 0 0 .154.292c.425.462 2.61 2.42 3.155 2.813.11.08.246.187.409.084l.004-.002ZM16.207 5.027c.168.093.3-.022.405-.108a34.622 34.622 0 0 0 3.006-2.98.41.41 0 0 0 .14-.3.43.43 0 0 0-.119-.31c-.189-.22-.534-.452-1.13-.78-.596-.328-.97-.5-1.254-.541a.39.39 0 0 0-.314.071.412.412 0 0 0-.163.287c-.168.61-.666 3.561-.715 4.25-.01.139-.028.314.14.41l.004.001ZM32.05 19.804H30.34a.521.521 0 0 1-.441-.16.564.564 0 0 1-.155-.458v-2.62a2.092 2.092 0 0 0-.603-1.41 1.947 1.947 0 0 0-1.38-.579c-.515 0-1.01.208-1.38.579-.369.371-.585.877-.602 1.41v2.62a.583.583 0 0 1-.157.457.54.54 0 0 1-.441.161h-1.71a.524.524 0 0 1-.441-.16.566.566 0 0 1-.157-.458V6.134a.585.585 0 0 1 .157-.458.543.543 0 0 1 .441-.163h1.71a.525.525 0 0 1 .442.162.566.566 0 0 1 .156.459v5.534a.435.435 0 0 0 .125.305.404.404 0 0 0 .3.117c.156-.024.306-.085.438-.178.131-.092.24-.214.32-.356l2.302-3.52c.278-.398.518-.591.897-.591h2.007c.424 0 .651.365.407.758l-2.579 3.632c-.136.22-.163.422.163.592.749.377 1.38.965 1.822 1.697.441.731.675 1.577.675 2.44v2.62a.58.58 0 0 1-.157.462.54.54 0 0 1-.448.158ZM41.67 7.156c-2.775 0-4.626 2.079-4.626 4.45v3.944c0 2.371 1.852 4.45 4.626 4.45 2.529 0 3.498-1.238 3.992-2.27a.647.647 0 0 0-.155-.799l-1.207-.827a.511.511 0 0 0-.414-.114.507.507 0 0 0-.356.248c-.488.852-1.06 1.23-1.86 1.23a1.771 1.771 0 0 1-.72-.131 1.823 1.823 0 0 1-.612-.414 1.902 1.902 0 0 1-.408-.629 1.959 1.959 0 0 1-.137-.744v-.48a.274.274 0 0 1 .074-.216.256.256 0 0 1 .21-.076h5.09c.72 0 1.131-.427 1.131-1.172v-2c-.004-2.371-1.853-4.45-4.628-4.45Zm1.875 4.93a.275.275 0 0 1-.073.217.255.255 0 0 1-.209.077h-3.182a.25.25 0 0 1-.21-.077.272.272 0 0 1-.074-.217v-.48a1.98 1.98 0 0 1 .571-1.334c.35-.35.818-.547 1.305-.547s.955.196 1.305.547c.35.351.555.83.571 1.334l-.004.48ZM55.889 7.665c1.181 0 1.663.807 2.174 1.696.186.308.509.334.804.14l1.26-.862c.322-.22.242-.64.161-.836-.51-1.364-2.01-2.782-4.4-2.782-2.897 0-4.83 2.17-4.83 4.648v5.685c0 2.477 1.933 4.646 4.83 4.646 2.39 0 3.89-1.419 4.4-2.782.08-.194.161-.612-.161-.834l-1.26-.862a.536.536 0 0 0-.433-.12.529.529 0 0 0-.371.258c-.511.891-.993 1.696-2.174 1.696a1.845 1.845 0 0 1-.75-.138 1.904 1.904 0 0 1-.64-.431 1.986 1.986 0 0 1-.425-.656 2.044 2.044 0 0 1-.143-.777V9.67c-.003-.267.045-.531.143-.777.097-.247.242-.47.425-.657.182-.187.4-.334.639-.432a1.85 1.85 0 0 1 .75-.138ZM68.72 7.29c-2.775 0-4.624 2.08-4.624 4.45v3.81c0 2.371 1.85 4.45 4.624 4.45 2.774 0 4.626-2.079 4.626-4.45v-3.81c0-2.362-1.85-4.45-4.626-4.45Zm1.877 8.26a1.98 1.98 0 0 1-.571 1.334c-.35.351-.818.547-1.305.547s-.955-.196-1.305-.547a1.98 1.98 0 0 1-.571-1.334v-3.81a1.98 1.98 0 0 1 .57-1.334c.351-.35.819-.547 1.306-.547.487 0 .955.196 1.305.547.35.351.555.83.571 1.334v3.81ZM92.51 7.3a4.565 4.565 0 0 0-2.362.646.26.26 0 0 1-.38-.112.556.556 0 0 0-.212-.194.533.533 0 0 0-.278-.059h-1.06a.525.525 0 0 0-.44.163.565.565 0 0 0-.156.457V19.2a.58.58 0 0 0 .155.457.538.538 0 0 0 .44.161h1.71a.525.525 0 0 0 .442-.16.566.566 0 0 0 .157-.458V12c0-.545.209-1.067.58-1.453a1.946 1.946 0 0 1 1.4-.601c.526 0 1.03.216 1.402.601.371.386.58.908.58 1.453v7.197a.582.582 0 0 0 .155.457.538.538 0 0 0 .441.161h1.71a.526.526 0 0 0 .441-.16.567.567 0 0 0 .157-.458V12c.002-2.505-1.951-4.7-4.883-4.7Z"
        />
      </svg>

      <DialogTitle
        as="h3"
        className="lk-text-2xl lk-font-bold lk-text-likecoin-500"
      >
        EVM Connect Portal
      </DialogTitle>

      <div>
        <Field className="lk-mt-6">
          <Input
            className="lk-block lk-w-full lk-rounded-lg lk-border-none lk-bg-black/5 lk-py-1.5 lk-px-3 lk-text-sm/6 lk-text-black lk-focus:outline-none lk-data-[focus]:outline-2 lk-data-[focus]:-outline-offset-2 lk-data-[focus]:outline-black/25"
            value={email}
            type="email"
            placeholder="john@example.com"
            onChange={(e) => setEmail(e.target.value)}
          />
        </Field>

        <button
          className={clsx(
            "lk-flex lk-items-center lk-mt-2 lk-w-full lk-bg-likecoin-500 lk-rounded-lg lk-min-h-[44px] lk-px-3 lk-py-2 lk-text-sm lk-font-medium",
            !!email && "lk-hover:bg-likecoin-700 lk-hover:text-white",
            email ? "lk-text-white" : "lk-text-likecoin-300"
          )}
          disabled={!email}
          onClick={() => connectWith("email")}
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M3.33329 16.6672C2.87496 16.6672 2.48274 16.5041 2.15663 16.178C1.83051 15.8519 1.66718 15.4594 1.66663 15.0005V5.00053C1.66663 4.5422 1.82996 4.14997 2.15663 3.82386C2.48329 3.49775 2.87551 3.33442 3.33329 3.33386H16.6666C17.125 3.33386 17.5175 3.4972 17.8441 3.82386C18.1708 4.15053 18.3338 4.54275 18.3333 5.00053V15.0005C18.3333 15.4589 18.1702 15.8514 17.8441 16.178C17.518 16.5047 17.1255 16.6678 16.6666 16.6672H3.33329ZM9.99996 10.8339L3.33329 6.6672V15.0005H16.6666V6.6672L9.99996 10.8339ZM9.99996 9.1672L16.6666 5.00053H3.33329L9.99996 9.1672ZM3.33329 6.6672V5.00053V15.0005V6.6672Z"
              fill="currentColor"
            />
          </svg>

          <span className="lk-grow lk-mr-[20px]">Continue with Email</span>
        </button>
      </div>

      {props.providers?.length && (
        <div className="lk-mt-4">
          <Description
            as="div"
            className="lk-flex lk-items-center lk-gap-[8px] lk-text-sm/6 lk-text-center lk-text-gray-500"
          >
            <hr className="lk-grow lk-border-gray-600" />
            or
            <hr className="lk-grow lk-border-gray-600" />
          </Description>
          <ul className="lk-flex lk-items-center lk-flex-col lk-gap-2 lk-mt-4 lk-w-full">
            {props.providers?.map(({ id, name }) => (
              <li key={id} className="lk-w-full">
                <button
                  className="lk-flex lk-items-center lk-w-full lk-text-gray-900 lk-bg-gray-100 hover:lk-bg-gray-200 lk-rounded-lg lk-min-h-[44px] lk-px-3 lk-py-2 lk-text-sm lk-font-medium lk-border lk-border-gray-300"
                  onClick={() => connectWith(id)}
                >
                  {id === "io.cosmostation" && <CosmostationIcon />}
                  {id === "io.metamask" && <MetamaskIcon />}
                  {id === "app.keplr" && <KeplrIcon />}
                  {id === "io.rabby" && <RabbyIcon />}
                  <span className="lk-grow lk-mr-[20px] first:lk-mr-0">
                    {name}
                  </span>
                </button>
              </li>
            ))}
          </ul>
        </div>
      )}
    </PlainDialog>
  );
};
